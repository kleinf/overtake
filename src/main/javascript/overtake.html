<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>Overtake Javascript</title>
	<script type="text/javascript" src="jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="util/FieldFormatter.js"></script>
    <script type="text/javascript" src="util/FieldFormat.js"></script>
    <script type="text/javascript" src="util/BorderFormat.js"></script>
    <script type="text/javascript" src="util/PointFormat.js"></script>
    <script type="text/javascript" src="util/FieldRelation.js"></script>
    <script type="text/javascript" src="util/Shape.js"></script>
    <script type="text/javascript" src="util/FieldPart.js"></script>
    <script type="text/javascript" src="util/Field.js"></script>

	<script type="text/javascript">
        function load(fieldFile) {
            $.getJSON("fields/" + fieldFile, function(fieldData) {
                document.getElementById("fieldDesc").value = JSON.stringify(fieldData, null, 2);
            });
        }

        function show(fieldFile, showSegments, borderless) {
            var fieldFormatter = new FieldFormatter();
            fieldFormatter.initJson(JSON.parse(document.getElementById("fieldDesc").value));
            drawBoard(fieldFormatter, showSegments, borderless);
        }

        function drawBoard(fieldFormatter, showSegments, borderless) {
            var numFieldsWidth = 10;
            var numFieldsHeight = 10;
            var canvas = document.getElementById("board");
            var ctx = canvas.getContext('2d');
            ctx.clearRect (0, 0, canvas.width, canvas.height); 
            ctx.strokeStyle = "black";
            ctx.lineWidth = 1;
            var fieldSize = fieldFormatter.getFieldsize(canvas.width, canvas.height, 0, 0, numFieldsWidth, numFieldsHeight);
            ctx.translate(-0.5, -0.5);
            for (var idY = 0; idY < numFieldsHeight; idY++) {
                for (var idX = 0; idX < numFieldsWidth; idX++) {
                    if(showSegments) {
                        drawSegments(fieldFormatter, ctx, fieldSize, idX, idY, numFieldsWidth, numFieldsHeight, borderless);
                    }
                    drawPolygon(fieldFormatter, ctx, fieldSize, idX, idY, numFieldsWidth, numFieldsHeight, borderless);
                }
            }
            ctx.translate(0.5, 0.5);
        }

        function drawPolygon(fieldFormatter, ctx, fieldSize, idX, idY, numFieldsWidth, numFieldsHeight, borderless) {
            var polygon = fieldFormatter.getPolygon(fieldSize[0], fieldSize[1], true, idX, idY, numFieldsWidth, numFieldsHeight, borderless);
            var cmds = polygon.getDrawCmds();
            if(cmds != void(0) && cmds.length > 0) {
                ctx.beginPath();
                for(var i in cmds) {
                    if(cmds[i].getPointType() == "MOVE") {
                        ctx.moveTo(cmds[i].getPosX1(), cmds[i].getPosY1());
                    }
                    if(cmds[i].getPointType() == "LINE") {
                        ctx.lineTo(cmds[i].getPosX1(), cmds[i].getPosY1());
                    }
                    if(cmds[i].getPointType() == "QUAD") {
                        ctx.quadraticCurveTo(cmds[i].getPosX1(), cmds[i].getPosY1(), cmds[i].getPosX2(), cmds[i].getPosY2());
                    }
                    if(cmds[i].getPointType() == "CURVE") {
                        ctx.bezierCurveTo(cmds[i].getPosX1(), cmds[i].getPosY1(), cmds[i].getPosX2(), cmds[i].getPosY2(), cmds[i].getPosX3(), cmds[i].getPosY3());
                    }
                }
                ctx.stroke();
            }
        }

        function drawSegments(fieldFormatter, ctx, fieldSize, idX, idY, numFieldsWidth, numFieldsHeight, borderless) {
            var segments = fieldFormatter.getSegments(fieldSize[0], fieldSize[1], true, idX, idY, numFieldsWidth, numFieldsHeight, borderless);
            var colorIndex = 0;
            for(var i in segments) {
                if(segments[i] == void(0)) {
                    continue;
                }
                var cmds = segments[i].getDrawCmds();
                if(cmds != void(0) && cmds.length > 0) {
                    ctx.beginPath();
                    for(var j in cmds) {
                        if(cmds[j].getPointType() == "MOVE") {
                            ctx.moveTo(cmds[j].getPosX1(), cmds[j].getPosY1());
                        }
                        if(cmds[j].getPointType() == "LINE") {
                            ctx.lineTo(cmds[j].getPosX1(), cmds[j].getPosY1());
                        }
                        if(cmds[j].getPointType() == "QUAD") {
                            ctx.quadraticCurveTo(cmds[j].getPosX1(), cmds[j].getPosY1(), cmds[j].getPosX2(), cmds[j].getPosY2());
                        }
                        if(cmds[j].getPointType() == "CURVE") {
                            ctx.bezierCurveTo(cmds[j].getPosX1(), cmds[j].getPosY1(), cmds[j].getPosX2(), cmds[j].getPosY2(), cmds[j].getPosX3(), cmds[j].getPosY3());
                        }
                    }
                    if (colorIndex % 8 == 0) {
                        ctx.fillStyle = "pink";
                    } else if (colorIndex % 7 == 0) {
                        ctx.fillStyle = "orange";
                    } else if (colorIndex % 6 == 0) {
                        ctx.fillStyle = "yellow";
                    } else if (colorIndex % 5 == 0) {
                        ctx.fillStyle = "magenta";
                    } else if (colorIndex % 4 == 0) {
                        ctx.fillStyle = "cyan";
                    } else if (colorIndex % 3 == 0) {
                        ctx.fillStyle = "blue";
                    } else if (colorIndex % 2 == 0) {
                        ctx.fillStyle = "green";
                    } else {
                        ctx.fillStyle = "red";
                    }
                    ctx.fill();
                }
                colorIndex++;
            }
        }
	</script>
</head>

<body>
	<h1>Overtake</h1>
	<form>
        <select id="fieldFile">
            <option value="A0.json">A0</option>        
            <option value="Cube.json">Cube</option>
            <option value="Curved.json">Curved</option>
            <option value="Hex1.json">Hex1</option>
            <option value="Hex2.json">Hex2</option>
            <option value="Hex3.json">Hex3</option>
            <option value="Hex4.json">Hex4</option>
            <option value="Oct.json">Oct</option>
            <option value="Pent1.json">Pent1</option>
            <option value="Pent2.json">Pent2</option>
            <option value="Plus1.json">Plus1</option>
            <option value="Plus2.json">Plus2</option>
            <option value="Quad.json">Quad</option>
            <option value="Raute1.json">Raute1</option>
            <option value="Raute2.json">Raute2</option>
            <option value="Span.json">Span</option>
            <option value="Tri1.json">Tri1</option>
            <option value="Tri2.json">Tri2</option>
        </select>
        <input type="button" value="load" onClick="load(this.form.fieldFile.options[this.form.fieldFile.selectedIndex].value)" />
        <input type="button" value="show" onClick="show(this.form.fieldFile.options[this.form.fieldFile.selectedIndex].value, this.form.showSegments.checked, this.form.borderless.checked)" />
        <input id="showSegments" type="checkbox" value="true" onClick="show(this.form.fieldFile.options[this.form.fieldFile.selectedIndex].value, this.form.showSegments.checked, this.form.borderless.checked)">Show segments</input>
        <input id="borderless" type="checkbox" value="true" onClick="show(this.form.fieldFile.options[this.form.fieldFile.selectedIndex].value, this.form.showSegments.checked, this.form.borderless.checked)">Borderless</input>
    </form>
    <br />
    <textarea id="fieldDesc" cols="50" rows="25"></textarea>
    <canvas id="board" width="400" height="400" style="border:1px solid #000000;"></canvas>
</body>

</html>
